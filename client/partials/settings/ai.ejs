<div id="ai_input_div" class="row mb-2">

    <!-- Must use typeof to check if variable exists at all, since it might be undefined -->
    <% if (typeof nations === "object" && Array.isArray(nations) === false) { %>
        
        <legend class="col-form-label col-sm-3 pt-0">AI Nations</legend>
        
        <% for (let eraNbr in nations) { %>

            <div id="ai_<%=eraNbr%>_container" class="col-sm-9" name="ai_select_container" <% if (typeof gameSettings === "object" && gameSettings.era != eraNbr) { %> style="display:none;" <% } %> >
                
                <select id="input_ai_<%=eraNbr%>" name="aiNations" class="cwSelect form-control selectpicker" data-size="8" multiple data-selected-text-format="count" data-live-search="true">

                    <% nations[eraNbr].forEach((nation) => { %>
  
                        <optgroup label="<%=nation.name %>" data-max-options="1">
                            
                            <option name="nation" data-subtext="easy" value="<%=nation.number %> easy"        <% if (typeof gameSettings === "object" && gameSettings.aiNations[nation.number] != null && gameSettings.aiNations[nation.number] === "easy") { %> selected <% } %> ><%=nation.name  %></option>
                            <option name="nation" data-subtext="normal" value="<%=nation.number %> normal"      <% if (typeof gameSettings === "object" && gameSettings.aiNations[nation.number] != null && gameSettings.aiNations[nation.number] === "normal") { %> selected <% } %> ><%=nation.name %></option>
                            <option name="nation" data-subtext="difficult" value="<%=nation.number %> difficult"   <% if (typeof gameSettings === "object" && gameSettings.aiNations[nation.number] != null && gameSettings.aiNations[nation.number] === "difficult") { %> selected <% } %> ><%=nation.name %></option>
                            <option name="nation" data-subtext="mighty" value="<%=nation.number %> mighty"      <% if (typeof gameSettings === "object" && gameSettings.aiNations[nation.number] != null && gameSettings.aiNations[nation.number] === "mighty") { %> selected <% } %> ><%=nation.name %></option>
                            <option name="nation" data-subtext="master" value="<%=nation.number %> master"      <% if (typeof gameSettings === "object" && gameSettings.aiNations[nation.number] != null && gameSettings.aiNations[nation.number] === "master") { %> selected <% } %> ><%=nation.name %></option>
                            <option name="nation" data-subtext="impossible" value="<%=nation.number %> impossible"  <% if (typeof gameSettings === "object" && gameSettings.aiNations[nation.number] != null && gameSettings.aiNations[nation.number] === "impossible") { %> selected <% } %> ><%=nation.name %></option>
       
                        </optgroup>

                    <% }); %>

                </select>
                
            </div>

        <% } %> <!-- for -->
    <% } %> <!-- if -->

    <!-- Update AI list based on chosen era -->
    <script src="../../js/update_ai_partial.js"></script>

</div>